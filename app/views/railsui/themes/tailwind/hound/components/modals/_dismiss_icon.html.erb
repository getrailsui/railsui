<div class="my-24">
  <%= render "railsui/shared/sticky_subhead", title: "Modals", subtitle: "With dismissable icon" %>

<div class="bg-black/80 flex items-center jusity-center p-10 rounded-t-lg">
  <div class="rounded mx-auto shadow-xl sm:w-full sm:max-w-lg bg-white m-1 p-6 origin-bottom flex items-start relative">
    <button type="button" class="absolute top-2 right-2 w-8 h-8 bg-transparent hover:bg-slate-50 flex items-center justify-center rounded-full group" data-action="click->modal#close">
      <%= icon "x-mark", styles: "text-slate-400 w-6 h-6 group-hover:text-slate-500 pointer-events-none" %>
    </button>
    <div class="w-8 h-8 rounded-full bg-red-50 flex items-center justify-center mr-3">
      <%= icon "exclamation-circle", styles: "w-6 h-6 text-red-600 flex-shrink-0" %>
    </div>

    <div class="flex-1">
      <h3 class="font-semibold text-lg text-slate-800 leading-tight mb-2">Delete account</h3>

      <p class="text-slate-600 leading-snug text-sm mb-6 mt-1">Once your account is deleted it is gone for good. There is no data saved that we keep on hand. Are you sure you want to continue?</p>

      <div class="flex justify-end items-center space-x-3">
        <button class="btn btn-light" data-action="click->modal#close">Cancel</button>
        <button class="btn bg-red-600 text-white focus:ring-red-100 hover:bg-red-700 hover:shadow-sm hover:shadow-slate-600/10">Delete</button>
      </div>
    </div>
  </div>
</div>

<div data-controller="modal">
  <div class="flex justify-center p-6 border-x border-b border-slate-200 rounded-b-lg relative">
    <div class="absolute top-4 left-4">
      <%= doc_label :demo %>
    </div>
    <button type="button" data-action="click->modal#open" class="btn btn-primary" tabindex="0">
      Open dismissable with icon modal
    </button>
  </div>
  <div
    aria-labelledby="single-action-modal-title"
    aria-modal="true"
    data-modal-target="container"
    class="hidden fixed inset-0 z-50 overflow-y-auto"
    role="dialog"
    >
    <div class="h-screen w-full relative flex items-center justify-center">
      <div
      data-modal-target="content"
      data-action="keyup@window->modal#closeWithEsc"
      data-transition-enter-active="transition ease-out duration-300"
      data-transition-enter-from="transform opacity-0 scale-95"
      data-transition-enter-to="transform opacity-100 scale-100"
      data-transition-leave-active="transition ease-in duration-300"
      data-transition-leave-from="transform opacity-100 scale-100"
      data-transition-leave-to="transform opacity-0 scale-95"
      class="hidden rounded mx-auto shadow-xl sm:w-full sm:max-w-lg bg-white m-1 p-6 origin-bottom relative">
      <div class="flex items-start">
        <button type="button" class="absolute top-2 right-2 w-8 h-8 bg-transparent hover:bg-slate-50 flex items-center justify-center rounded-full group" data-action="click->modal#close">
          <%= icon "x-mark", styles: "text-slate-400 w-6 h-6 group-hover:text-slate-500 pointer-events-none" %>
        </button>

        <div class="w-8 h-8 rounded-full bg-red-50 flex items-center justify-center mr-3">
          <%= icon "exclamation-circle", styles: "w-6 h-6 text-red-600 flex-shrink-0" %>
        </div>

        <div class="flex-1">
          <h3 class="font-semibold text-lg text-slate-800 leading-tight mb-2 pt-1">Delete account</h3>

          <p class="text-slate-600 leading-snug text-sm mb-6 mt-1">Once your account is deleted it is gone for good. There is no data saved that we keep on hand. Are you sure you want to continue?</p>

          <div class="flex justify-end items-center space-x-3">
            <button class="btn btn-light" data-action="click->modal#close">Cancel</button>
            <button class="btn bg-red-600 text-white focus:ring-red-100 hover:bg-red-700 hover:shadow-sm hover:shadow-slate-600/10">Delete</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<% content_for :html, flush: true do %>
<div data-controller="modal">
  <button type="button" data-action="click->modal#open" class="btn btn-primary" tabindex="0">
    Open dismissable with icon modal
  </button>

  <div
    aria-labelledby="single-action-modal-title"
    aria-modal="true"
    data-modal-target="container"
    class="hidden fixed inset-0 z-50 overflow-y-auto"
    role="dialog"
    >
    <div class="h-screen w-full relative flex items-center justify-center">
      <div
      data-modal-target="content"
      data-action="keyup@window->modal#closeWithEsc"
      data-transition-enter-active="transition ease-out duration-300"
      data-transition-enter-from="transform opacity-0 scale-95"
      data-transition-enter-to="transform opacity-100 scale-100"
      data-transition-leave-active="transition ease-in duration-300"
      data-transition-leave-from="transform opacity-100 scale-100"
      data-transition-leave-to="transform opacity-0 scale-95"
      class="hidden rounded mx-auto shadow-xl sm:w-full sm:max-w-lg bg-white m-1 p-6 origin-bottom relative">
      <div class="flex items-start">
        <button type="button" class="absolute top-2 right-2 w-8 h-8 bg-transparent hover:bg-slate-50 flex items-center justify-center rounded-full group" data-action="click->modal#close">
          <%%= icon "x-mark", styles: "text-slate-400 w-6 h-6 group-hover:text-slate-500 pointer-events-none" %>
        </button>

        <div class="w-8 h-8 rounded-full bg-red-50 flex items-center justify-center mr-3">
          <%%= icon "exclamation-circle", styles: "w-6 h-6 text-red-600 flex-shrink-0" %>
        </div>

        <div class="flex-1">
          <h3 class="font-semibold text-lg text-slate-800 leading-tight mb-2 pt-1">Delete account</h3>

          <p class="text-slate-600 leading-snug text-sm mb-6 mt-1">Once your account is deleted it is gone for good. There is no data saved that we keep on hand. Are you sure you want to continue?</p>

          <div class="flex justify-end items-center space-x-3">
            <button class="btn btn-light" data-action="click->modal#close">Cancel</button>
            <button class="btn bg-red-600 text-white focus:ring-red-100 hover:bg-red-700 hover:shadow-sm hover:shadow-slate-600/10">Delete</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<% end %>

<% content_for :haml, flush: true do %>
%div{"data-controller" => "modal"}
  %button.btn.btn-primary{"data-action" => "click->modal#open", tabindex: "0", type: "button"}
    Open dismissable with icon modal
  .hidden.fixed.inset-0.z-50.overflow-y-auto{"aria-labelledby" => "single-action-modal-title", "aria-modal" => "true", "data-modal-target" => "container", role: "dialog"}
    .h-screen.w-full.relative.flex.items-center.justify-center
      .hidden.rounded.mx-auto.shadow-xl.sm:w-full.sm:max-w-lg.bg-white.m-1.p-6.origin-bottom.relative{"data-action" => "keyup@window->modal#closeWithEsc", "data-modal-target" => "content", "data-transition-enter-active" => "transition ease-out duration-300", "data-transition-enter-from" => "transform opacity-0 scale-95", "data-transition-enter-to" => "transform opacity-100 scale-100", "data-transition-leave-active" => "transition ease-in duration-300", "data-transition-leave-from" => "transform opacity-100 scale-100", "data-transition-leave-to" => "transform opacity-0 scale-95"}
        .flex.items-start
          %button.absolute.top-2.right-2.w-8.h-8.bg-transparent.hover:bg-slate-50.flex.items-center.justify-center.rounded-full.group{"data-action" => "click->modal#close", type: "button"}
            = icon "x-mark", styles: "text-slate-400 w-6 h-6 group-hover:text-slate-500 pointer-events-none" %>
          .w-8.h-8.rounded-full.bg-red-50.flex.items-center.justify-center.mr-3
            = icon "exclamation-circle", styles: "w-6 h-6 text-red-600 flex-shrink-0" %>
          .flex-1
            %h3.font-semibold.text-lg.text-slate-800.leading-tight.mb-2.pt-1 Delete account
            %p.text-slate-600.leading-snug.text-sm.mb-6.mt-1 Once your account is deleted it is gone for good. There is no data saved that we keep on hand. Are you sure you want to continue?
            .flex.justify-end.items-center.space-x-3
              %button.btn.btn-light{"data-action" => "click->modal#close"} Cancel
              %button.btn.bg-red-600.text-white.focus:ring-red-100.hover:bg-red-700.hover:shadow-sm{class: "hover:shadow-slate-600/10"} Delete
<% end %>

<% content_for :js, flush: true do %>
// app/javascript/controllers/modal_controller.js

import { Controller } from "@hotwired/stimulus"
import { useTransition } from 'stimulus-use'

export default class extends Controller {
  static targets = ['container', 'content']

  connect() {
    useTransition(this, {
      element: this.contentTarget,
    })
  }

  open(e) {
    e.preventDefault()
    this.enableAppearance()
    this.toggleTransition()
  }

  close() {
    this.leave();
    this.disableAppearance()
  }

  closeWithEsc(e){
    if (e.keyCode === 27 && !this.containerTarget.classList.contains('hidden')) {
      this.close(e);
    }
  }

  enableAppearance() {
    this.containerTarget.classList.add("bg-black/80")
    this.containerTarget.classList.remove('hidden')
  }

  disableAppearance() {
    this.containerTarget.classList.add('hidden')
    this.containerTarget.classList.remove("bg-black/80")
  }

  disconnect() {
    this.toggleTransition()
  }
}
<% end %>

<%= render_snippet(js_filename: "modal_controller.js") %>
</div>
